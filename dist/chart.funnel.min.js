/*!
 * Chart.Funnel.js
 * A funnel plugin for Chart.js(http://chartjs.org/)
 * Version: 1.1.2
 *
 * Copyright 2016 Jone Casaper & YetiForce
 * Released under the MIT license
 * https://github.com/xch89820/Chart.Funnel.js/blob/master/LICENSE.md
 */
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;((t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Chart||(t.Chart={})).Funnel=e()}}(function(){return function(){return function e(t,r,o){function n(i,l){if(!r[i]){if(!t[i]){var d="function"==typeof require&&require;if(!l&&d)return d(i,!0);if(a)return a(i,!0);var s=new Error("Cannot find module '"+i+"'");throw s.code="MODULE_NOT_FOUND",s}var u=r[i]={exports:{}};t[i][0].call(u.exports,function(e){var r=t[i][1][e];return n(r||e)},u,u.exports,e,t,r,o)}return r[i].exports}for(var a="function"==typeof require&&require,i=0;i<o.length;i++)n(o[i]);return n}}()({1:[function(e,t,r){},{}],2:[function(e,t,r){"use strict";var o=e(1);o="function"==typeof o?o:window.Chart,e(4)(o),e(3)(o),t.exports=o},{1:1,3:3,4:4}],3:[function(e,t,r){"use strict";t.exports=function(e){var t=e.helpers;e.defaults.funnel={hover:{mode:"label"},sort:"asc",gap:0,bottomWidth:null,topWidth:0,keep:"auto",elements:{borderWidth:0},tooltips:{callbacks:{title:function(e,t){return""},label:function(e,t){return t.labels[e.index]+": "+t.datasets[e.datasetIndex].data[e.index]}}},legendCallback:function(e){var t=[];t.push('<ul class="'+e.id+'-legend">');var r=e.data,o=r.datasets,n=r.labels;if(o.length)for(var a=0;a<o[0].data.length;++a)t.push('<li><span style="background-color:'+o[0].backgroundColor[a]+'"></span>'),n[a]&&t.push(n[a]),t.push("</li>");return t.push("</ul>"),t.join("")},legend:{labels:{generateLabels:function(e){var r=e.data;return r.labels.length&&r.datasets.length?r.labels.map(function(o,n){var a=e.getDatasetMeta(0),i=r.datasets[0],l=a.data[n],d=l.custom||{},s=t.getValueAtIndexOrDefault,u=e.options.elements.trapezium;return{text:o,fillStyle:d.backgroundColor?d.backgroundColor:s(i.backgroundColor,n,u.backgroundColor),strokeStyle:d.borderColor?d.borderColor:s(i.borderColor,n,u.borderColor),lineWidth:d.borderWidth?d.borderWidth:s(i.borderWidth,n,u.borderWidth),hidden:isNaN(i.data[n])||a.data[n].hidden,index:n,_index:l._index}}):[]}},onClick:function(e,t){var r,o,n,a=t.index,i=this.chart;for(r=0,o=(i.data.datasets||[]).length;r<o;++r)(n=i.getDatasetMeta(r)).data[a].hidden=!n.data[a].hidden;i.update()}},scales:{yAxes:[{position:"left",type:"category",display:!1,categoryPercentage:.8,barPercentage:.9,offset:!0,gridLines:{offsetGridLines:!0}}]}},e.controllers.funnel=e.DatasetController.extend({dataElementType:e.elements.Trapezium,initialize:function(r,o){if(e.controllers.bar.prototype.initialize.call(this,r,o),void 0!==r.options&&void 0!==r.options.sort&&"data"!==r.options.sort.substr(0,4)){var n=r.data.datasets[o],a=[];n.data.slice();t.each(n.data,function(e,t){a.push({index:t,value:e})}),a.sort(function(e,t){return"asc"===r.options.sort?e.value-t.value:t.value-e.value}),r.data.labels=r.data.labels.map(function(e,t){return r.data.labels[a[t].index]});for(var i=Object.keys(n),l=0,d=i.length;l<d;l++){var s=i[l],u=n[s];n.hasOwnProperty(s)&&Array.isArray(u)&&(n[s]=u.map(function(e,t){return u[a[t].index]}))}}},linkScales:function(){var e=this.getMeta(),t=this.getDataset();null!==e.yAxisID&&e.yAxisID in this.chart.scales||(e.yAxisID=t.yAxisID||this.chart.options.scales.yAxes[0].id)},update:function(e){var r=this,o=r.chart,n=o.chartArea,a=o.options,i=r.getMeta().data,l=a.elements.borderWidth||0,d=n.right-n.left-2*l,s=n.bottom-n.top-2*l,u=d,h=(a.topWidth<d?a.topWidth:d)||0;a.bottomWidth&&(u=a.bottomWidth<d?a.bottomWidth:d);var c=r.getDataset(),f=[],p=0,b=0;t.each(c.data,function(e,r){var n=t.getValueAtIndexOrDefault(c.backgroundColor,r),a=i[r].hidden;f.push({hidden:a,orgIndex:r,val:e,backgroundColor:n,borderColor:t.getValueAtIndexOrDefault(c.borderColor,r,n),label:t.getValueAtIndexOrDefault(c.label,r,o.data.labels[r])}),i[r].hidden||(p++,b=e>b?e:b)});var g=u/b,v=0;t.each(f,function(e,t){e._viewIndex=e.hidden?-1:v++});var x=a.gap||0,m=(s-(p-1)*x)/p;r.topWidth=h,r.dwRatio=g,r.elHeight=m,r.valAndLabels=f,t.each(i,function(t,o){r.updateElement(t,o,e)},r)},updateElement:function(e,r,o){var n,a,i,l,d,s,u=this,h=u.chart,c=h.chartArea,f=h.options,p=f.sort,b=u.dwRatio,g=u.elHeight,v=f.gap||0,x=f.elements.borderWidth||0,m="isosceles",y=u.valAndLabels[r],C=y._viewIndex<0?r:y._viewIndex,W=c.top+(C+1)*(g+v)-v,k=u.getMeta();if(e._yScale=u.getScaleForId(k.yAxisID),"asc"!==p&&"data-asc"!==p&&p){if("desc"===p||"data-desc"===p){var _=t.findNextWhere(u.valAndLabels,function(e){return!e.hidden},r);d=y.val*b,s=_?_.val*b:u.topWidth}}else{var w=t.findPreviousWhere(u.valAndLabels,function(e){return!e.hidden},r);d=w?w.val*b:u.topWidth,s=y.val*b}a=c.top+y.orgIndex*(g+v),"left"===f.keep?(m="scalene",i=c.left+d/2,l=c.left+s/2,n=i):"right"===f.keep?(m="scalene",i=c.right-d/2,l=c.right-s/2,n=i):n=(c.left+c.right)/2,t.extend(e,{_datasetIndex:u.index,_index:y.orgIndex,_model:{type:m,y:a,base:W>c.bottom?c.bottom:W,x:n,x1:i,x2:l,upperWidth:o||y.hidden?0:d,bottomWidth:o||y.hidden?0:s,borderWidth:x,backgroundColor:y&&y.backgroundColor,borderColor:y&&y.borderColor,label:y&&y.label}}),e.pivot()},removeHoverStyle:function(t){e.DatasetController.prototype.removeHoverStyle.call(this,t,this.chart.options.elements.trapezium)}})}},{}],4:[function(e,t,r){"use strict";t.exports=function(e){e.helpers;var t=e.defaults.global;t.elements.trapezium={backgroundColor:t.defaultColor,borderWidth:0,borderColor:t.defaultColor,borderSkipped:"bottom",type:"isosceles"};e.elements.Trapezium=e.elements.Rectangle.extend({getCorners:function(){var e=this._view,r=t.elements.trapezium,o=[],n=e.type||r.type,a=e.y,i=e.borderWidth||r.borderWidth,l=e.upperWidth/2,d=e.bottomWidth/2,s=i/2;if(s=s<0?0:s,"isosceles"==n){var u=e.x;o=[[u-d+s,e.base],[u-l+s,a+s],[u+l-s,a+s],[u+d-s,e.base]]}else if("scalene"==n){var h=e.x1,c=e.x2;o=[[c-d+s,e.base],[h-l+s,a+s],[h+l-s,a+s],[c+d-s,e.base]]}return o},draw:function(){var e=this._chart.ctx,r=this._view,o=t.elements.trapezium,n=this.getCorners();this._cornersCache=n,e.beginPath(),e.fillStyle=r.backgroundColor||o.backgroundColor,e.strokeStyle=r.borderColor||o.borderColor,e.lineWidth=r.borderWidth||o.borderWidth;var a=["bottom","left","top","right"].indexOf(r.borderSkipped||o.borderSkipped,0);function i(e){return n[(a+e)%4]}-1===a&&(a=0),e.moveTo.apply(e,i(0));for(var l=1;l<4;l++)e.lineTo.apply(e,i(l));e.fill(),r.borderWidth&&e.stroke()},height:function(){var e=this._view;return e?e.base-e.y:0},inRange:function(e,t){return!!this._view&&function(e,t){for(var r=e[0],o=e[1],n=!1,a=0,i=t.length-1;a<t.length;i=a++){var l=t[a][0],d=t[a][1],s=t[i][0],u=t[i][1];d>o!=u>o&&r<(s-l)*(o-d)/(u-d)+l&&(n=!n)}return n}([e,t],this._cornersCache?this._cornersCache:this.getCorners())},inLabelRange:function(e){var t=this._view;if(!t)return!1;if("scalene"==t.type)return t.x1>t.x2?e>=t.x2-t.bottomWidth/2&&e<=t.x1+t.upperWidth/2:e<=t.x2+t.bottomWidth/2&&e>=t.x1-t.upperWidth/2;var r=Math.max(t.upperWidth,t.bottomWidth);return e>=t.x-r/2&&e<=t.x+r/2},tooltipPosition:function(){var e=this._view;return{x:e.x||e.x2,y:e.base-(e.base-e.y)/2}},getArea:function(){this._view;for(var e=0,t=this._cornersCache?this._cornersCache:this.getCorners(),r=0,o=t.length;r<o;r++){e+=t[r][0]*t[r==t.length-1?0:r+1][1]*.5,e-=t[r==t.length-1?0:r+1][0]*t[r][1]*.5}return Math.abs(e)},getCenterPoint:function(){var e,t,r,o,n,a=this._cornersCache?this._cornersCache:this.getCorners(),i=(this._view,0),l=0;for(e=0,t=a.length-1;e<a.length;t=e,e++)o=a[e],n=a[t],r=o[0]*n[1]-n[0]*o[1],i+=(o[0]+n[0])*r,l+=(o[1]+n[1])*r;return{x:i/(r=6*this.getArea()),y:l/r}}})}},{}]},{},[2])(2)});